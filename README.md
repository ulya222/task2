# DataVault — Учёт ресурсов и задач

Информационная система для учёта ресурсов, планирования задач, контроля проверок и замечаний: ресурсы (код, остатки, поставщики), категории и состав, задачи по фазам, проверки и замечания, отчётность и экспорт.

## Технологический стек

- **Backend:** ASP.NET Core 8, Entity Framework Core, SQL Server (LocalDB)
- **Frontend:** WPF (.NET 8), MVVM (CommunityToolkit.Mvvm)
- **API:** REST, Swagger

## Структура проекта

- `Core` — сущности, DbContext
- `Server` — веб-API
- `Client` — WPF-клиент
- `Schema` — скрипты инициализации БД (SQL Server и PostgreSQL)

## Запуск

### 1. База данных (SQL Server / LocalDB)

1. Установите SQL Server или SQL Server LocalDB (обычно уже есть с Visual Studio).
2. Выполните скрипт `Schema/Init_DataVaultDB.sql` в SSMS или через `sqlcmd` (при необходимости создайте базу `DataVaultDb`).
3. Либо при первом запуске API база будет создана автоматически через EF Core и заполнена начальными данными.

**Строка подключения по умолчанию** (в `Server/appsettings.json`):  
`Server=(localdb)\\mssqllocaldb;Database=DataVaultDb;Trusted_Connection=True;`

**Если используете PostgreSQL:** выполните `Schema/Init_DataVaultDB_PostgreSQL.sql` в своей БД и настройте в коде провайдер Npgsql и строку подключения.

### 2. API (Server)

```bash
dotnet run --project Server
```

API доступен по адресу http://127.0.0.1:5050. Swagger: http://127.0.0.1:5050/swagger

### 3. WPF-клиент (Client)

```bash
dotnet run --project Client
```

**Учётные данные по умолчанию:** логин `admin`, пароль `password`.

## Модули

1. **Ресурсы** — код, наименование, тип, производитель, остатки, мин/макс запас, поставщики, история операций.
2. **Задачи** — категории, состав категории (ресурсы и количество), фазы (Новый, В работе, На проверке и т.д.), плановые даты, себестоимость.
3. **Проверки и замечания** — привязка к задачам, процедуры проверки, результат, сертификаты; типы и описание замечаний.
4. **Сводка и отчётность** — ключевые показатели, экспорт в Excel/PDF, уведомления о низких остатках.

## Экранные формы

Навигация — левая панель (вертикальное меню):

1. **Сводка** — ключевые показатели, экспорт ресурсов/задач/сводки (Excel, PDF), уведомление о низких остатках.
2. **Ресурсы** — таблица ресурсов, поиск, поле «Код» (сканирование + Enter), создание/редактирование/удаление, история операций.
3. **Задачи** — таблица и канбан по фазам, новая задача, смена фазы, состав категории.
4. **Проверки** — вкладки «Проверки» и «Замечания», добавление проверки/замечания, паспорт задачи.
5. **Обзор** — задачи за сегодня, в работе, низкие остатки, срочные задачи, кнопка «Синхронизировать».

## Роли

- Администратор
- Руководитель
- Специалист
- Кладовщик

(Начальные данные задаются в скрипте и при первом запуске API.)

## Изменение паролей

Для генерации BCrypt-хеша:

```bash
set DATAVAULT_HASH_PASSWORD=ваш_новый_пароль
dotnet run --project Server -- hash
```

Скопируйте выведенный хеш и обновите поле `PasswordHash` в таблице `AppUser` в БД.

## Дополнительные возможности

- **Тема** — переключатель «Светлая тема» / «Тёмная тема» в левой панели (внизу).
- **Код (сканирование)** — на разделе «Ресурсы» введите код в поле «Код» и нажмите Enter для поиска и выделения строки.
- **Канбан задач** — на разделе «Задачи» переключение «Таблица» / «Канбан» для отображения по фазам.

## Переменные окружения

- `DATAVAULT_HASH_PASSWORD` — пароль, для которого генерируется хеш при запуске `dotnet run --project Server -- hash`.
